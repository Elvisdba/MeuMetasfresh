-- View: "de.metas.materialtracking".not_waschproble_pp_orders_that_still_have_ics

-- DROP VIEW "de.metas.materialtracking".not_waschproble_pp_orders_that_still_have_ics;

CREATE OR REPLACE VIEW "de.metas.materialtracking".not_waschproble_pp_orders_that_still_have_ics AS 
 SELECT mt.lot,
    po.documentno,
    po_dt.name,
    ic.qtyinvoiced AS ic_qtyinvoiced,
    ic.ad_client_id,
    ic.ad_org_id,
    ic.c_invoice_candidate_id,
    ic.c_orderline_id,
    ic.created,
    ic.createdby,
    ic.isactive,
    ic.qtytoinvoice,
    ic.updated,
    ic.updatedby,
    ic.schedulerresult,
    ic.priceactual_override,
    ic.discount_override,
    ic.bill_bpartner_id,
    ic.bill_location_id,
    ic.bill_user_id,
    ic.invoicerule,
    ic.qtytoinvoicenetamt,
    ic.dateinvoiced,
    ic.istoclear,
    ic.m_product_id,
    ic.dateordered,
    ic.processed,
    ic.priceactual,
    ic.c_currency_id,
    ic.qtyordered,
    ic.qtydelivered,
    ic.qtyinvoiced,
    ic.qtytoinvoice_override,
    ic.qtytoinvoice_overridefulfilled,
    ic.c_charge_id,
    ic.bill_bpartner_override_id,
    ic.invoicerule_override,
    ic.m_pricingsystem_id,
    ic.discount,
    ic.netamttoinvoice,
    ic.netamtinvoiced,
    ic.c_invoice_candidate_agg_id,
    ic.lineaggregationkey,
    ic.lineaggregationkey_suffix,
    ic.c_ilcandhandler_id,
    ic.ad_table_id,
    ic.record_id,
    ic.iserror,
    ic.ad_note_id,
    ic.errormsg,
    ic.datetoinvoice,
    ic.datetoinvoice_override,
    ic.c_conversiontype_id,
    ic.invoicescheduleamtstatus,
    ic.ismanual,
    ic.description,
    ic.ad_user_incharge_id,
    ic.headeraggregationkey,
    ic.splitamt,
    ic.descriptionheader,
    ic.descriptionbottom,
    ic.priceentered,
    ic.priceentered_override,
    ic.issotrx,
    ic.qualitydiscountpercent_effective,
    ic.qualitynote_receiptschedule,
    ic.qualitydiscountpercent,
    ic.qualitydiscountpercent_override,
    ic.isindispute,
    ic.qtywithissues,
    ic.qtyorderedoverunder,
    ic.reasondiscount,
    ic.c_uom_id,
    ic.price_uom_id,
    ic.c_order_id,
    ic.c_activity_id,
    ic.c_tax_id,
    ic.qtytoinvoiceinpriceuom,
    ic.isprinted,
    ic.line,
    ic.c_doctypeinvoice_id,
    ic.m_material_tracking_id,
    ic.approvalforinvoicing,
    ic.c_tax_override_id
   FROM c_invoice_candidate ic
     JOIN ad_table t ON t.ad_table_id = ic.ad_table_id
     JOIN pp_order po ON po.pp_order_id = ic.record_id AND t.tablename::text = 'PP_Order'::text
     JOIN c_doctype po_dt ON po_dt.c_doctype_id = po.c_doctype_id
     LEFT JOIN m_material_tracking mt ON mt.m_material_tracking_id = ic.m_material_tracking_id
  WHERE po_dt.name::text <> 'Waschprobe'::text
  ORDER BY po.documentno;

